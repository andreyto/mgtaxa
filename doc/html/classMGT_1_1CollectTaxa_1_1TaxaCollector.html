<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>Mgtaxa: MGT::CollectTaxa::TaxaCollector Class Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.7.2 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li class="current"><a href="annotated.html"><span>Classes</span></a></li>
    </ul>
  </div>
  <div class="tabs2">
    <ul class="tablist">
      <li><a href="annotated.html"><span>Class&#160;List</span></a></li>
      <li><a href="hierarchy.html"><span>Class&#160;Hierarchy</span></a></li>
      <li><a href="functions.html"><span>Class&#160;Members</span></a></li>
    </ul>
  </div>
  <div class="navpath">
    <ul>
      <li><b>MGT</b>      </li>
      <li><b>CollectTaxa</b>      </li>
      <li><a class="el" href="classMGT_1_1CollectTaxa_1_1TaxaCollector.html">TaxaCollector</a>      </li>
    </ul>
  </div>
</div>
<div class="header">
  <div class="summary">
<a href="#pub-methods">Public Member Functions</a> &#124;
<a href="#pub-static-attribs">Static Public Attributes</a>  </div>
  <div class="headertitle">
<h1>MGT::CollectTaxa::TaxaCollector Class Reference</h1>  </div>
</div>
<div class="contents">
<!-- doxytag: class="MGT::CollectTaxa::TaxaCollector" --><!-- doxytag: inherits="MGT::Config::MGTOptions" -->
<p>Inherits MGT::Config::MGTOptions.</p>

<p><a href="classMGT_1_1CollectTaxa_1_1TaxaCollector-members.html">List of all members.</a></p>
<table class="memberdecls">
<tr><td colspan="2"><h2><a name="pub-methods"></a>
Public Member Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">def&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classMGT_1_1CollectTaxa_1_1TaxaCollector.html#a555057a3450389bb18febdd402bbb519">loadTaxTables</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">def&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classMGT_1_1CollectTaxa_1_1TaxaCollector.html#a729815520f17bd2079c663fc57fc6705">createFullTextIndexSeqHeader</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">def&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classMGT_1_1CollectTaxa_1_1TaxaCollector.html#aeea49d4747d064cdc6b180e86a4a21d4">loadTaxNames</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">def&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classMGT_1_1CollectTaxa_1_1TaxaCollector.html#ad4ed657d87990c0c5fbb05ccae9d7e11">delDuplicateGiFromSeq</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">def&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classMGT_1_1CollectTaxa_1_1TaxaCollector.html#a5674db7af24c1f3d30ca14ab89c7f043">selectActiveSeq</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">def&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classMGT_1_1CollectTaxa_1_1TaxaCollector.html#a5d510f2f31f070e5eaa397ad01533749">excludePreSource</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">def&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classMGT_1_1CollectTaxa_1_1TaxaCollector.html#a73ba2806cb2491b64dc83f1e4aab5fce">selectSeqBySource</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">def&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classMGT_1_1CollectTaxa_1_1TaxaCollector.html#a09e07946d735b3ca29e16b326a614585">excludePostSource</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">def&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classMGT_1_1CollectTaxa_1_1TaxaCollector.html#af4625f9ec06ac8185c2d8e8fa630a228">exportIdsForSeqDb</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">def&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classMGT_1_1CollectTaxa_1_1TaxaCollector.html#a3b7a2ff61d5f6daa0683fb111f3eea09">loadSeqToHdf</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">def&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classMGT_1_1CollectTaxa_1_1TaxaCollector.html#a2ee55902de16cdb0c273c548c7e3441b">indexHdfSeq</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">def&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classMGT_1_1CollectTaxa_1_1TaxaCollector.html#a8a28f98f995a6eca548c9dd98c76a662">indexHdfActiveSeq</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">def&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classMGT_1_1CollectTaxa_1_1TaxaCollector.html#aa09423f942b8ac1961b87ec74ed634f6">reportStat</a></td></tr>
<tr><td colspan="2"><h2><a name="pub-static-attribs"></a>
Static Public Attributes</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classMGT_1_1CollectTaxa_1_1TaxaCollector.html#a5693252f79ef68870802502ff7462e30">tblNodes</a> = self.taxaTreeDbStore.tblNodes</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">We exclude records that are in subtrees of taxidDrop taxids, or have undefined taxonomy fields or with divid from dividDrop list.  <a href="#a5693252f79ef68870802502ff7462e30"></a><br/></td></tr>
</table>
<hr/><a name="_details"></a><h2>Detailed Description</h2>
<div class="fragment"><pre class="fragment">Collects data about taxonomically known sequence for training the classifier.
Process the NCBI BLAST DB files by calling fastacmd.
Aggregate, prioritize and partially remove redundancy along the taxonomy ids.</pre></div> <hr/><h2>Member Function Documentation</h2>
<a class="anchor" id="a729815520f17bd2079c663fc57fc6705"></a><!-- doxytag: member="MGT::CollectTaxa::TaxaCollector::createFullTextIndexSeqHeader" ref="a729815520f17bd2079c663fc57fc6705" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">def MGT::CollectTaxa::TaxaCollector::createFullTextIndexSeqHeader </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"> <em>self</em>&#160;)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<div class="fragment"><pre class="fragment">Build a full text index for sequence FASTA hdeaders in 'seq_hdr' table (currently implemented only for MySQL back-end).
Warning: it took 1 hr for 28M records.</pre></div> 
</div>
</div>
<a class="anchor" id="ad4ed657d87990c0c5fbb05ccae9d7e11"></a><!-- doxytag: member="MGT::CollectTaxa::TaxaCollector::delDuplicateGiFromSeq" ref="ad4ed657d87990c0c5fbb05ccae9d7e11" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">def MGT::CollectTaxa::TaxaCollector::delDuplicateGiFromSeq </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"> <em>self</em>&#160;)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<div class="fragment"><pre class="fragment">Delete duplicate records (by gi) from seq table, leave only those with smallest gi.
Duplicate records appear because some sequences (with identical defline) are included
into both 'refseq_genomic' and 'other_genomic' BLAST databases.</pre></div> 
</div>
</div>
<a class="anchor" id="a09e07946d735b3ca29e16b326a614585"></a><!-- doxytag: member="MGT::CollectTaxa::TaxaCollector::excludePostSource" ref="a09e07946d735b3ca29e16b326a614585" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">def MGT::CollectTaxa::TaxaCollector::excludePostSource </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"> <em>self</em>&#160;)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<div class="fragment"><pre class="fragment">Exclude some sequence after selectTaxSource().
@post table act_seq is mapping into seq and act_src
@post table act_src is all_src with some records
dropped and seq_len recomputed from seq_src.
The combination of these two new tables allows to
filter initial sequence set described by all_src 
both at individual sequence level (e.g. drop short sequences)
and at source id level (meaning origin,sequence type)
(e.g. retain only longest RefSeq strain for each species).
Currently this method does not drop any sequence.
After this method, act_seq and act_src can be used
to randomly sample for training and testing sets.</pre></div> 
</div>
</div>
<a class="anchor" id="a5d510f2f31f070e5eaa397ad01533749"></a><!-- doxytag: member="MGT::CollectTaxa::TaxaCollector::excludePreSource" ref="a5d510f2f31f070e5eaa397ad01533749" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">def MGT::CollectTaxa::TaxaCollector::excludePreSource </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"> <em>self</em>&#160;)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<div class="fragment"><pre class="fragment">Exclude some sequence before selectTaxSource()
@post table seq_excl has excluded idseq's.
We exclude records that are likely to be outliers in composition:
rRNA genes, plasmids and genomic islands.
Then we exclude all NT records that are not complete genome or complete chromosome.</pre></div> 
</div>
</div>
<a class="anchor" id="af4625f9ec06ac8185c2d8e8fa630a228"></a><!-- doxytag: member="MGT::CollectTaxa::TaxaCollector::exportIdsForSeqDb" ref="af4625f9ec06ac8185c2d8e8fa630a228" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">def MGT::CollectTaxa::TaxaCollector::exportIdsForSeqDb </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"> <em>self</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"> <em>seqTable</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<div class="fragment"><pre class="fragment">Write text files with sequence ids that will be used to create sequence HDF5 files.
Ids are extracted from act_seq table.
Currently we load only NCBI sequence, but we want to decouple SeqDB from NCBI GIs
in case we will also use non-NCBI sequence in the future. Therefore, we write
a file with (GI,ID) pairs where ID is our internal sequence id. The order is defined by
our tree nested set index. That most closely corresponds to the order in which
we will be traversing the tree most of the time.</pre></div> 
</div>
</div>
<a class="anchor" id="a8a28f98f995a6eca548c9dd98c76a662"></a><!-- doxytag: member="MGT::CollectTaxa::TaxaCollector::indexHdfActiveSeq" ref="a8a28f98f995a6eca548c9dd98c76a662" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">def MGT::CollectTaxa::TaxaCollector::indexHdfActiveSeq </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"> <em>self</em>&#160;)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<div class="fragment"><pre class="fragment">Create HDF index dataset for active sequence (from act_seq table).</pre></div> 
</div>
</div>
<a class="anchor" id="a2ee55902de16cdb0c273c548c7e3441b"></a><!-- doxytag: member="MGT::CollectTaxa::TaxaCollector::indexHdfSeq" ref="a2ee55902de16cdb0c273c548c7e3441b" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">def MGT::CollectTaxa::TaxaCollector::indexHdfSeq </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"> <em>self</em>&#160;)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<div class="fragment"><pre class="fragment">Create SQL tables that index sequence in HDF dataset.</pre></div> 
</div>
</div>
<a class="anchor" id="a3b7a2ff61d5f6daa0683fb111f3eea09"></a><!-- doxytag: member="MGT::CollectTaxa::TaxaCollector::loadSeqToHdf" ref="a3b7a2ff61d5f6daa0683fb111f3eea09" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">def MGT::CollectTaxa::TaxaCollector::loadSeqToHdf </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"> <em>self</em>&#160;)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<div class="fragment"><pre class="fragment">Load sequence data for all records in 'seq' table into HDF dataset.</pre></div> 
</div>
</div>
<a class="anchor" id="aeea49d4747d064cdc6b180e86a4a21d4"></a><!-- doxytag: member="MGT::CollectTaxa::TaxaCollector::loadTaxNames" ref="aeea49d4747d064cdc6b180e86a4a21d4" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">def MGT::CollectTaxa::TaxaCollector::loadTaxNames </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"> <em>self</em>&#160;)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<div class="fragment"><pre class="fragment">We load only 'scientific name' entries.</pre></div> 
</div>
</div>
<a class="anchor" id="a555057a3450389bb18febdd402bbb519"></a><!-- doxytag: member="MGT::CollectTaxa::TaxaCollector::loadTaxTables" ref="a555057a3450389bb18febdd402bbb519" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">def MGT::CollectTaxa::TaxaCollector::loadTaxTables </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"> <em>self</em>&#160;)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<div class="fragment"><pre class="fragment">Create and fill all initial tables with taxa tree data.
It only needs NCBI taxonomy dump files.
It assigns dummy zero values to seq_len and seq_len_total attributes.
Result: original tree dumf files as well as our tree object with nested set index etc 
is saved in SQL DB</pre></div> 
</div>
</div>
<a class="anchor" id="aa09423f942b8ac1961b87ec74ed634f6"></a><!-- doxytag: member="MGT::CollectTaxa::TaxaCollector::reportStat" ref="aa09423f942b8ac1961b87ec74ed634f6" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">def MGT::CollectTaxa::TaxaCollector::reportStat </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"> <em>self</em>&#160;)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<div class="fragment"><pre class="fragment">Output a report that shows a high-level overview of data.</pre></div> 
</div>
</div>
<a class="anchor" id="a5674db7af24c1f3d30ca14ab89c7f043"></a><!-- doxytag: member="MGT::CollectTaxa::TaxaCollector::selectActiveSeq" ref="a5674db7af24c1f3d30ca14ab89c7f043" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">def MGT::CollectTaxa::TaxaCollector::selectActiveSeq </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"> <em>self</em>&#160;)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<div class="fragment"><pre class="fragment">Select 'active' source sequence set - the one that can be used for training.
@post tables act_seq and act_src contain usable training sequence.</pre></div> 
</div>
</div>
<a class="anchor" id="a73ba2806cb2491b64dc83f1e4aab5fce"></a><!-- doxytag: member="MGT::CollectTaxa::TaxaCollector::selectSeqBySource" ref="a73ba2806cb2491b64dc83f1e4aab5fce" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">def MGT::CollectTaxa::TaxaCollector::selectSeqBySource </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"> <em>self</em>&#160;)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<div class="fragment"><pre class="fragment">For each taxid, group available sequence by its source (refseq, wgs, htgs, nt) and select groups by priority.
@post table all_src that has all selected groups and synthetic primary key 'id' for each group.</pre></div> 
</div>
</div>
<hr/><h2>Member Data Documentation</h2>
<a class="anchor" id="a5693252f79ef68870802502ff7462e30"></a><!-- doxytag: member="MGT::CollectTaxa::TaxaCollector::tblNodes" ref="a5693252f79ef68870802502ff7462e30" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classMGT_1_1CollectTaxa_1_1TaxaCollector.html#a5693252f79ef68870802502ff7462e30">MGT::CollectTaxa::TaxaCollector::tblNodes</a> = self.taxaTreeDbStore.tblNodes<code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>We exclude records that are in subtrees of taxidDrop taxids, or have undefined taxonomy fields or with divid from dividDrop list. </p>

</div>
</div>
<hr/>The documentation for this class was generated from the following file:<ul>
<li>mgtaxa/MGT/CollectTaxa.py</li>
</ul>
</div>
<hr class="footer"/><address class="footer"><small>Generated on Thu Jan 20 2011 17:14:41 for Mgtaxa by&#160;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.2 </small></address>
</body>
</html>
